server:
  ## Grafana Pod annotations:
  ##
  # annotations:
  #   iam.amazonaws.com/role: grafana

  ## Grafana service port
  ##
  httpPort: 80

  ## Grafana Docker image
  ##
  image: "grafana/grafana:latest"

  nodeSelector: {}

  ingress:
    ## If true, Grafana Ingress will be created
    ##
    enabled: false

    ## Grafana Ingress annotations
    ##
    # annotations:
    #   kubernetes.io/ingress.class: nginx
    #   kubernetes.io/tls-acme: 'true'

    ## Grafana Ingress hostnames
    ## Must be provided if Ingress is enabled
    ##
    # hosts:
    #   - grafana.domain.com

    ## Grafana Ingress TLS configuration
    ## Secrets must be manually created in the namespace
    ##
    # tls:
    #   - secretName: grafana-server-tls
    #     hosts:
    #       - grafana.domain.com

  ## Grafana container name
  ##
  name: grafana

  adminUser: "admin"
  adminPassword: "admin"

  ## Global imagePullPolicy
  ## Default: 'Always' if image tag is 'latest', else 'IfNotPresent'
  ## Ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images
  ##
  # imagePullPolicy:

  # Persist data to a persitent volume
  persistentVolume:
    ## If true, Grafana will create a Persistent Volume Claim
    ## If false, use emptyDir
    ##
    enabled: true

    ## Grafana data Persistent Volume access modes
    ## Must match those of existing PV or dynamic provisioner
    ## Ref: http://kubernetes.io/docs/user-guide/persistent-volumes/
    ##
    accessModes:
      - ReadWriteOnce

    ## Grafana data Persistent Volume annotations
    ##
    annotations: {}

    ## Grafana data Persistent Volume existing claim name
    ## Requires server.persistentVolume.enabled: true
    ## If defined, PVC must be created manually before volume will be bound
    existingClaim: ""

    ## Grafana data Persistent Volume size
    ## Default: 1Gi
    ##
    size: 1Gi

    ## Data Persistent Volume Storage Class
    ## If defined, volume.beta.kubernetes.io/storage-class: <storageClass>
    ## Default: volume.alpha.kubernetes.io/storage-class: default
    ##
    # storageClass:

    ## Data Persistent Volume existing claim name
    ## Requires server.persistentVolume.enabled: true
    ## If defined, PVC must be created manually before volume will be bound
    existingClaim: ""

    ## Subdirectory of data Persistent Volume to mount
    ## Useful if the volume's root directory is not empty
    ##
    subPath: ""

  ## Grafana resource requests and limits
  ## Ref: http://kubernetes.io/docs/user-guide/compute-resources/
  ##
  resources:
    # limits:
    #   cpu: 500m
    #   memory: 512Mi
    requests:
      cpu: 100m
      memory: 100Mi

  ## Grafana service type
  ##
  serviceType: NodePort

  ## Load balancer IP address
  ## Is not required, but allows for static address with
  ## serviceType LoadBalancer.
  ## If not supported by cloud provider, this field is ignored.
  ## Default: nil
  ##
  # loadBalancerIP: 130.211.x.x

  ## This will restrict traffic through the cloud-provider load-balancer
  ## to the specified client IPs.
  ## If not supported by cloud provider, this field is ignored.
  ## Default: nil
  ##
  # loadBalancerSourceRanges:
  #   - 0.0.0.0/0

  ## nodePort port number
  ## Is not required, but allows for static port assignment with
  ## serviceType NodePort.
  ## Default: nil
  # nodePort: 30000

  ## Grafana local config path
  ## Default '/etc/grafana'
  ##
  # configLocalPath: /etc/grafana

  ## Grafana local dashboards path
  ## Default: '/var/lib/grafana/dashboards'
  ##
  # dashboardLocalPath: /var/lib/grafana/dashboards

  ## Grafana local data storage path
  ## Default: '/var/lib/grafana/data'
  ##
  # storageLocalPath: /var/lib/grafana/data

  ## Grafana Pod termination grace period
  ## Default: 300s (5m)
  ##
  # terminationGracePeriodSeconds: 300

  ## Pass the plugins you want installed as a comma seperated list.
  ## This will pass each plugin name to `grafana-cli plugins install ${plugin}`.
  ## Ref: https://github.com/grafana/grafana-docker#installing-plugins-for-grafana-3
  ##
  # installPlugins:

  # Set datasource in beginning
  setDatasource:
    ## If true, an initial Grafana Datasource will be set
    ## Default: false
    ##
    enabled: true

    ## How long should it take to commit failure
    ## Default: 300
    ##
    # activeDeadlineSeconds: 300

    ## Curl Docker image
    ## Default: appropriate/curl:latest
    ##
    image: appropriate/curl:latest

    ## This assembles how curl post into Grafana
    ## Ref1: http://docs.grafana.org/reference/http_api/#create-data-source
    ## Ref2: https://github.com/grafana/grafana/issues/1789
    ##
    datasource:
      ## The datasource name.
      ## Default: default
      name: kanali

      ## Type of datasource
      ## Default: prometheus
      ##
      type: influxdb

      ## The url of the datasource. To set correctly you need to know
      ## the right datasource name and its port ahead. Check kubernetes
      ## dashboard or describe the service should fulfill the requirements.
      ## Synatx like `http://<release name>-<server name>:<port number>
      ## Default: "http://limping-tiger-server"
      ##
      url: "http://kanali-influxdb.default.svc.cluster.local:8086"

      ## The name of the database at the datasource.
      ## Required parameter when used with elasticsearch, which refers to the index_name
      ## Default: <empty>
      database: kanali

      ## Additional JSON data to be passed to the configuration of the datasource.
      ## The JSON data is passed to curl, therefore it needs proper quoting and
      ## escaping and needs to be on a single line. For example:
      ##  '\"esVersion\": 2, \"interval\": \"Daily\", \"timeField\": \"@timestamp\"'
      # jsonData: null

      ## Specify if Grafana has to go thru proxy to reach datasource
      ## Default: proxy
      ##
      access: proxy

      ## Specify should Grafana use this datasource as default
      ## Default: true
      ##
      isDefault: true

    ## Specify the job policy
    ## Default: OnFailure
    ##
    restartPolicy: OnFailure

## Grafana config file ConfigMap entry
##
serverConfigFile:
  grafana.ini: |
    ; instance_name = ${HOSTNAME}
    [paths]
    data = /var/lib/grafana/data
    logs = /var/log/grafana
    plugins = /var/lib/grafana/plugins

    [server]
    ;protocol = http
    ;http_addr =
    ;http_port = 3000
    ;domain = localhost
    ;enforce_domain = false
    ;root_url = %(protocol)s://%(domain)s:%(http_port)s/
    ;router_logging = false
    ;static_root_path = public
    ;enable_gzip = false
    ;cert_file =
    ;cert_key =

    [database]
    ;type = sqlite3
    ;host = 127.0.0.1:3306
    ;name = grafana
    ;user = root
    ;password =
    ;ssl_mode = disable
    ;path = grafana.db

    [session]
    ;provider = file
    ;provider_config = sessions
    ;cookie_name = grafana_sess
    ;cookie_secure = false
    ;session_life_time = 86400

    [analytics]
    ;reporting_enabled = true
    check_for_updates = true
    ;google_analytics_ua_id =

    [security]
    ;admin_user = admin
    ;admin_password = admin
    ;secret_key = SW2YcwTIb9zpOOhoPsMm
    ;login_remember_days = 7
    ;cookie_username = grafana_user
    ;cookie_remember_name = grafana_remember
    ;disable_gravatar = false
    ;data_source_proxy_whitelist =

    [snapshots]
    ;external_enabled = true
    ;external_snapshot_url = https://snapshots-origin.raintank.io
    ;external_snapshot_name = Publish to snapshot.raintank.io

    [users]
    ;allow_sign_up = false
    ;allow_org_create = false
    ;auto_assign_org = false
    ;auto_assign_org_role = Viewer
    ;login_hint = email or username
    ;default_theme = dark

    [auth.anonymous]
    enabled = true
    org_name = Main Org.
    org_role = Admin

    [auth.github]
    ;enabled = false
    ;allow_sign_up = false
    ;client_id = some_id
    ;client_secret = some_secret
    ;scopes = user:email,read:org
    ;auth_url = https://github.com/login/oauth/authorize
    ;token_url = https://github.com/login/oauth/access_token
    ;api_url = https://api.github.com/user
    ;team_ids =
    ;allowed_organizations =

    [auth.google]
    ;enabled = false
    ;allow_sign_up = false
    ;client_id = some_client_id
    ;client_secret = some_client_secret
    ;scopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email
    ;auth_url = https://accounts.google.com/o/oauth2/auth
    ;token_url = https://accounts.google.com/o/oauth2/token
    ;api_url = https://www.googleapis.com/oauth2/v1/userinfo
    ;allowed_domains =

    [auth.proxy]
    ;enabled = false
    ;header_name = X-WEBAUTH-USER
    ;header_property = username
    ;auto_sign_up = true

    [auth.basic]
    ;enabled = true

    [auth.ldap]
    ;enabled = false
    ;config_file = /etc/grafana/ldap.toml

    [smtp]
    ;enabled = false
    ;host = localhost:25
    ;user =
    ;password =
    ;cert_file =
    ;key_file =
    ;skip_verify = false
    ;from_address = admin@grafana.localhost

    [emails]
    ;welcome_email_on_sign_up = false

    [log]
    mode = console
    level = info

    [log.console]
    ;level =
    ;format = console

    [event_publisher]
    ;enabled = false
    ;rabbitmq_url = amqp://localhost/
    ;exchange = grafana_events

    [dashboards.json]
    enabled = true
    path = /var/lib/grafana/dashboards

    [metrics]
    ;enabled           = true
    ;interval_seconds  = 10

    ; [metrics.graphite]
    ; address = localhost:2003
    ; prefix = prod.grafana.%(instance_name)s.

    [grafana_net]
    url = https://grafana.net


## Grafana dashboard files ConfigMap entries
## If you'd like to preinstall prometheus dashboard on the same namespace as example, get it from:
##
## https://grafana.net/dashboards/2
##
## and add it below.
##
serverDashboardFiles:
  kanali.json: |+
    {
      "annotations": {
        "list": []
      },
      "description": "Kanali Metrics",
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "id": null,
      "links": [],
      "refresh": "1m",
      "rows": [
        {
          "collapse": false,
          "height": 250,
          "panels": [
            {
              "aliasColors": {
                "total requests for $proxyName": "#5195CE"
              },
              "bars": true,
              "dashLength": 10,
              "dashes": false,
              "datasource": "kanali",
              "description": "request count matching filters",
              "fill": 1,
              "id": 1,
              "interval": "1m",
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "links": [],
              "minSpan": 12,
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [
                {
                  "alias": "/total requests for */",
                  "color": "rgb(190, 127, 173)"
                },
                {
                  "alias": "/total errors for */",
                  "color": "rgb(222, 107, 115)"
                }
              ],
              "spaceLength": 10,
              "span": 12,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "alias": "total requests for $proxyName",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "$__interval"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                },
                {
                  "alias": "total errors for $proxyName",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "$__interval"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "query": "SELECT count(\"clientIP\") FROM \"request_details\" WHERE \"proxyName\" =~ /^$proxyName$/ AND \"responseCode\" = '401' AND \"keyName\" =~ /^$keyName$/ AND \"method\" =~ /^$httpMethod$/ AND $timeFilter GROUP BY time($__interval) fill(0)",
                  "rawQuery": false,
                  "refId": "B",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "http_response_code",
                      "operator": "=~",
                      "value": "/^$errorCode$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Total Requests",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "transparent": false,
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": "0",
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Snapshot",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": 250,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "kanali",
              "description": "aggregated proxy response time metrics",
              "fill": 3,
              "id": 2,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 2,
              "links": [],
              "minSpan": 6,
              "nullPointMode": "null",
              "percentage": true,
              "pointradius": 3,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "/average response time for */",
                  "color": "rgb(190, 127, 173)"
                }
              ],
              "spaceLength": 10,
              "span": 6,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "alias": "average response time for $proxyName",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "mean"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Average Proxy Response Time",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": "0",
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "kanali",
              "description": "aggregated target response time",
              "fill": 3,
              "id": 11,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 2,
              "links": [],
              "minSpan": 6,
              "nullPointMode": "null",
              "percentage": true,
              "pointradius": 3,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "/average response time for */",
                  "color": "rgb(190, 127, 173)"
                }
              ],
              "spaceLength": 10,
              "span": 6,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "alias": "average response time for $proxyName",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_target_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "mean"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Average Target Response Time",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": "0",
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "200",
          "panels": [
            {
              "cacheTimeout": null,
              "colorBackground": true,
              "colorValue": false,
              "colors": [
                "rgba(214,203,211,1)",
                "rgb(190, 127, 173)",
                "rgba(214,203,211,1)"
              ],
              "datasource": "kanali",
              "decimals": 0,
              "description": "total requests matching filters",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "id": 5,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "requests ",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 4,
              "sparkline": {
                "fillColor": "rgba(255, 255, 255, 0.18)",
                "full": false,
                "lineColor": "rgb(255, 255, 255)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "$__interval"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "null"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                }
              ],
              "thresholds": "",
              "title": "",
              "type": "singlestat",
              "valueFontSize": "150%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "0",
                  "value": "null"
                }
              ],
              "valueName": "total"
            },
            {
              "cacheTimeout": null,
              "colorBackground": true,
              "colorValue": false,
              "colors": [
                "rgba(150,206,180,1)",
                "rgb(80, 177, 132)",
                "rgba(150,206,180,1)"
              ],
              "datasource": "kanali",
              "decimals": 0,
              "description": "total request success matching filters",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "id": 7,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "success",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 4,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "$__interval"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "null"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    },
                    {
                      "condition": "AND",
                      "key": "http_response_code",
                      "operator": "=~",
                      "value": "/^$success_code$/"
                    }
                  ]
                }
              ],
              "thresholds": "",
              "title": "",
              "type": "singlestat",
              "valueFontSize": "150%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "0",
                  "value": "null"
                }
              ],
              "valueName": "total"
            },
            {
              "cacheTimeout": null,
              "colorBackground": true,
              "colorValue": false,
              "colors": [
                "rgba(236,161,166,1)",
                "rgb(222, 107, 115)",
                "rgba(236,161,166,1)"
              ],
              "datasource": "kanali",
              "decimals": 0,
              "description": "total request errors matching filters",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "id": 6,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "errors",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 4,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "$__interval"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "null"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    },
                    {
                      "condition": "AND",
                      "key": "http_response_code",
                      "operator": "!~",
                      "value": "/^$success_code$/"
                    }
                  ]
                }
              ],
              "thresholds": "",
              "title": "",
              "type": "singlestat",
              "valueFontSize": "150%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "0",
                  "value": "null"
                }
              ],
              "valueName": "total"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Mega",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": 250,
          "panels": [
            {
              "aliasColors": {
                "99th": "#705DA0"
              },
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "kanali",
              "description": "response time percentiles",
              "fill": 3,
              "id": 10,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 2,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 12,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "alias": "99th",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [
                          "99"
                        ],
                        "type": "percentile"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                },
                {
                  "alias": "95th",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "B",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [
                          "95"
                        ],
                        "type": "percentile"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                },
                {
                  "alias": "90th",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "C",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [
                          "90"
                        ],
                        "type": "percentile"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                },
                {
                  "alias": "80th",
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "1m"
                      ],
                      "type": "time"
                    },
                    {
                      "params": [
                        "0"
                      ],
                      "type": "fill"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "D",
                  "resultFormat": "time_series",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [
                          "80"
                        ],
                        "type": "percentile"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "proxy_name",
                      "operator": "=~",
                      "value": "/^$proxyName$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_namespace",
                      "operator": "=~",
                      "value": "/^$proxyNamespace$/"
                    }
                  ]
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Response Time Percentiles",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": "0",
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Percentiles",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": 250,
          "panels": [
            {
              "columns": [],
              "datasource": "kanali",
              "description": "average response time per proxy",
              "fontSize": "100%",
              "id": 3,
              "links": [],
              "pageSize": null,
              "scroll": true,
              "showHeader": true,
              "sort": {
                "col": 2,
                "desc": false
              },
              "span": 6,
              "styles": [
                {
                  "alias": "Proxy Name",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 2,
                  "pattern": "proxy_name",
                  "preserveFormat": false,
                  "sanitize": false,
                  "thresholds": [],
                  "type": "string",
                  "unit": "short"
                },
                {
                  "alias": "Avg Response Time",
                  "colorMode": "value",
                  "colors": [
                    "rgb(80, 177, 132)",
                    "rgb(255, 204, 102)",
                    "rgb(222, 107, 115)"
                  ],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 0,
                  "pattern": "mean",
                  "thresholds": [
                    "500",
                    "1000"
                  ],
                  "type": "number",
                  "unit": "ms"
                },
                {
                  "alias": "remove",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 2,
                  "pattern": "Time",
                  "thresholds": [],
                  "type": "hidden",
                  "unit": "short"
                }
              ],
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "proxy_name"
                      ],
                      "type": "tag"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "table",
                  "select": [
                    [
                      {
                        "params": [
                          "total_time"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "mean"
                      }
                    ]
                  ],
                  "tags": []
                }
              ],
              "title": "Avg Response Time by API Proxy",
              "transform": "table",
              "transparent": false,
              "type": "table"
            },
            {
              "columns": [],
              "datasource": "kanali",
              "description": "total requests by api key",
              "fontSize": "100%",
              "id": 4,
              "links": [],
              "pageSize": null,
              "scroll": true,
              "showHeader": true,
              "sort": {
                "col": 2,
                "desc": true
              },
              "span": 6,
              "styles": [
                {
                  "alias": "API Key Name",
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 0,
                  "pattern": "api_key_name",
                  "thresholds": [
                    ""
                  ],
                  "type": "string",
                  "unit": "none"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 2,
                  "pattern": "Time",
                  "thresholds": [],
                  "type": "hidden",
                  "unit": "short"
                },
                {
                  "alias": "Request Count",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 0,
                  "pattern": "count",
                  "thresholds": [],
                  "type": "number",
                  "unit": "none"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "decimals": 2,
                  "pattern": "/.*/",
                  "thresholds": [],
                  "type": "number",
                  "unit": "short"
                }
              ],
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "api_key_name"
                      ],
                      "type": "tag"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "table",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "api_key_name",
                      "operator": "!=",
                      "value": "none"
                    }
                  ]
                }
              ],
              "title": "Requests by API Key",
              "transform": "table",
              "type": "table"
            },
            {
              "columns": [],
              "datasource": "kanali",
              "description": "total error count by api proxy",
              "fontSize": "100%",
              "id": 8,
              "links": [],
              "pageSize": null,
              "scroll": true,
              "showHeader": true,
              "sort": {
                "col": 2,
                "desc": true
              },
              "span": 6,
              "styles": [
                {
                  "alias": "API Proxy",
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "pattern": "proxy_name",
                  "type": "string"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 2,
                  "pattern": "Time",
                  "thresholds": [],
                  "type": "hidden",
                  "unit": "short"
                },
                {
                  "alias": "Request Count",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 0,
                  "pattern": "count",
                  "thresholds": [],
                  "type": "number",
                  "unit": "none"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "decimals": 2,
                  "pattern": "/.*/",
                  "thresholds": [],
                  "type": "number",
                  "unit": "short"
                }
              ],
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "proxy_name"
                      ],
                      "type": "tag"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "table",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "http_response_code",
                      "operator": "=~",
                      "value": "/^$errorCode$/"
                    },
                    {
                      "condition": "AND",
                      "key": "proxy_name",
                      "operator": "!=",
                      "value": "unknown"
                    }
                  ]
                }
              ],
              "title": "Error Count by API Proxy",
              "transform": "table",
              "type": "table"
            },
            {
              "columns": [],
              "datasource": "kanali",
              "description": "total error count by api key",
              "fontSize": "100%",
              "id": 9,
              "links": [],
              "pageSize": null,
              "scroll": true,
              "showHeader": true,
              "sort": {
                "col": 2,
                "desc": true
              },
              "span": 6,
              "styles": [
                {
                  "alias": "API Key",
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "pattern": "api_key_name",
                  "type": "string"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 2,
                  "pattern": "Time",
                  "thresholds": [],
                  "type": "hidden",
                  "unit": "short"
                },
                {
                  "alias": "Request Count",
                  "colorMode": null,
                  "colors": [],
                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                  "decimals": 0,
                  "pattern": "count",
                  "thresholds": [],
                  "type": "number",
                  "unit": "none"
                },
                {
                  "alias": "",
                  "colorMode": null,
                  "colors": [],
                  "decimals": 2,
                  "pattern": "/.*/",
                  "thresholds": [],
                  "type": "number",
                  "unit": "short"
                }
              ],
              "targets": [
                {
                  "dsType": "influxdb",
                  "groupBy": [
                    {
                      "params": [
                        "api_key_name"
                      ],
                      "type": "tag"
                    }
                  ],
                  "measurement": "request_details",
                  "orderByTime": "ASC",
                  "policy": "default",
                  "refId": "A",
                  "resultFormat": "table",
                  "select": [
                    [
                      {
                        "params": [
                          "client_ip"
                        ],
                        "type": "field"
                      },
                      {
                        "params": [],
                        "type": "count"
                      }
                    ]
                  ],
                  "tags": [
                    {
                      "key": "http_response_code",
                      "operator": "=~",
                      "value": "/^$errorCode$/"
                    },
                    {
                      "condition": "AND",
                      "key": "api_key_name",
                      "operator": "!=",
                      "value": "none"
                    }
                  ]
                }
              ],
              "title": "Error Count by API Key",
              "transform": "table",
              "type": "table"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "By Proxy",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": [
          {
            "allValue": null,
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": "kanali",
            "hide": 0,
            "includeAll": true,
            "label": "Proxy Name",
            "multi": true,
            "name": "proxyName",
            "options": [],
            "query": "SHOW TAG VALUES WITH KEY = \"proxy_name\"",
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": "kanali",
            "hide": 0,
            "includeAll": true,
            "label": "Proxy Namespace",
            "multi": true,
            "name": "proxyNamespace",
            "options": [],
            "query": "SHOW TAG VALUES WITH KEY = \"proxy_namespace\"",
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": "kanali",
            "hide": 2,
            "includeAll": true,
            "label": null,
            "multi": false,
            "name": "errorCode",
            "options": [],
            "query": "SHOW TAG VALUES WITH KEY = \"http_response_code\"",
            "refresh": 2,
            "regex": "/[4-9][0-9][0-9]/",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": "kanali",
            "hide": 2,
            "includeAll": true,
            "label": "",
            "multi": false,
            "name": "success_code",
            "options": [],
            "query": "SHOW TAG VALUES WITH KEY = \"http_response_code\"",
            "refresh": 2,
            "regex": "/[123][0-9][0-9]/",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-30m",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "browser",
      "title": "Kanali",
      "version": 0
    }